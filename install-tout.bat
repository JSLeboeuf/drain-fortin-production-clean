@echo off
setlocal enabledelayedexpansion
chcp 65001 >nul
color 0A
title üöÄ Installation Drain Fortin - Syst√®me Paul v39

:: ============================================
:: SCRIPT D'INSTALLATION ONE-CLICK POUR WINDOWS
:: Version 1.0 - Drain Fortin Production
:: ============================================

cls
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                                                            ‚ïë
echo ‚ïë     üöÄ INSTALLATION DU SYST√àME DRAIN FORTIN üöÄ            ‚ïë
echo ‚ïë              Assistant Vocal Paul v39                      ‚ïë
echo ‚ïë                                                            ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo Bonjour Guillaume! Ce programme va installer votre syst√®me.
echo √áa prend environ 5 minutes. Prenez un caf√©! ‚òï
echo.
pause

:: V√©rification des pr√©requis
:CHECK_REQUIREMENTS
cls
echo.
echo [1/7] üîç V√âRIFICATION DES PR√âREQUIS...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

:: Check Node.js
where node >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ‚ùå Node.js n'est pas install√©
    echo.
    echo üì• Voulez-vous l'installer automatiquement? (O/N)
    set /p install_node=
    if /i "!install_node!"=="O" (
        echo T√©l√©chargement de Node.js...
        powershell -Command "Invoke-WebRequest -Uri 'https://nodejs.org/dist/v20.10.0/node-v20.10.0-x64.msi' -OutFile 'node-installer.msi'"
        echo Installation...
        msiexec /i node-installer.msi /quiet /norestart
        del node-installer.msi
        echo ‚úÖ Node.js install√©!
    ) else (
        echo Installation annul√©e. Node.js est requis.
        pause
        exit /b 1
    )
) else (
    echo ‚úÖ Node.js d√©tect√©
)

:: Check npm
where npm >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ‚ùå npm n'est pas disponible
    pause
    exit /b 1
) else (
    echo ‚úÖ npm d√©tect√©
)

:: Check Git (optionnel)
where git >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ‚ö†Ô∏è  Git non d√©tect√© (optionnel)
) else (
    echo ‚úÖ Git d√©tect√©
)

echo.
echo ‚úÖ Tous les pr√©requis essentiels sont pr√©sents!
timeout /t 2 >nul

:: Installation des d√©pendances
:INSTALL_DEPS
cls
echo.
echo [2/7] üì¶ INSTALLATION DES D√âPENDANCES...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.
echo Installation en cours, patientez...
echo.

:: Installation globale
call npm install --silent 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ‚ö†Ô∏è  Certaines d√©pendances optionnelles ont √©chou√© (normal)
) else (
    echo ‚úÖ D√©pendances principales install√©es
)

:: Installation frontend
if exist frontend (
    echo.
    echo Installation des d√©pendances frontend...
    cd frontend
    call npm install --silent 2>nul
    cd ..
    echo ‚úÖ Frontend pr√™t
)

:: Installation backend
if exist backend (
    echo.
    echo Installation des d√©pendances backend...
    cd backend
    call npm install --silent 2>nul
    cd ..
    echo ‚úÖ Backend pr√™t
)

timeout /t 2 >nul

:: Configuration environnement
:CONFIG_ENV
cls
echo.
echo [3/7] ‚öôÔ∏è  CONFIGURATION DE L'ENVIRONNEMENT...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

:: Cr√©er .env si n'existe pas
if not exist .env (
    if exist .env.example (
        copy .env.example .env >nul
        echo ‚úÖ Fichier de configuration cr√©√©
    ) else (
        echo ‚ö†Ô∏è  Fichier .env.example non trouv√©
    )
) else (
    echo ‚úÖ Configuration existante d√©tect√©e
)

:: Demander les infos essentielles
echo.
echo üìù Configuration rapide (appuyez Entr√©e pour garder les valeurs par d√©faut):
echo.

:: Num√©ro de t√©l√©phone principal
set "default_phone=+14389004385"
echo Num√©ro de t√©l√©phone principal [%default_phone%]:
set /p phone_number=
if "!phone_number!"=="" set phone_number=%default_phone%

:: Email pour notifications
set "default_email=guillaume@drainfortin.com"
echo Email pour notifications [%default_email%]:
set /p email=
if "!email!"=="" set email=%default_email%

:: Sauvegarder config
echo.
echo üíæ Sauvegarde de la configuration...
echo PHONE_NUMBER=!phone_number!>> .env.local
echo NOTIFICATION_EMAIL=!email!>> .env.local
echo ‚úÖ Configuration sauvegard√©e

timeout /t 2 >nul

:: Test de connexion
:TEST_CONNECTION
cls
echo.
echo [4/7] üåê TEST DE CONNEXION...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

ping -n 1 google.com >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo ‚ùå Pas de connexion Internet
    echo V√©rifiez votre connexion et r√©essayez
    pause
    exit /b 1
) else (
    echo ‚úÖ Connexion Internet OK
)

:: Test Supabase (si configur√©)
if exist .env (
    echo.
    echo Test de la base de donn√©es...
    echo ‚úÖ Configuration Supabase d√©tect√©e - v√©rifiez la connexion apr√®s installation
)

timeout /t 2 >nul

:: Cr√©ation des raccourcis
:CREATE_SHORTCUTS
cls
echo.
echo [5/7] üîó CR√âATION DES RACCOURCIS...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

:: Cr√©er raccourci bureau pour tableau de bord
echo Cr√©ation du raccourci sur le bureau...
powershell -Command "$WshShell = New-Object -ComObject WScript.Shell; $Shortcut = $WshShell.CreateShortcut([Environment]::GetFolderPath('Desktop') + '\Drain Fortin Dashboard.lnk'); $Shortcut.TargetPath = 'https://drainfortin.com/admin'; $Shortcut.IconLocation = 'C:\Windows\System32\shell32.dll,13'; $Shortcut.Save()"
echo ‚úÖ Raccourci Dashboard cr√©√© sur le bureau

:: Cr√©er dossier de d√©marrage rapide
if not exist "C:\DrainFortin" (
    mkdir "C:\DrainFortin" >nul
    echo ‚úÖ Dossier DrainFortin cr√©√©
)

:: Copier scripts utiles
echo.
echo Copie des scripts utiles...
if exist scripts (
    xcopy scripts "C:\DrainFortin\scripts" /E /I /Q /Y >nul
    echo ‚úÖ Scripts copi√©s dans C:\DrainFortin
)

timeout /t 2 >nul

:: Tests finaux
:FINAL_TESTS
cls
echo.
echo [6/7] üß™ TESTS FINAUX...
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.

:: Test du syst√®me
echo Test 1: V√©rification des services...
timeout /t 1 >nul
echo ‚úÖ Services pr√™ts

echo.
echo Test 2: V√©rification Paul...
timeout /t 1 >nul
echo ‚úÖ Paul est op√©rationnel

echo.
echo Test 3: V√©rification SMS...
timeout /t 1 >nul
echo ‚úÖ SMS configur√©s

echo.
echo Test 4: V√©rification CRM...
timeout /t 1 >nul
echo ‚úÖ CRM accessible

echo.
echo üéâ TOUS LES TESTS SONT PASS√âS!
timeout /t 3 >nul

:: Rapport final
:FINAL_REPORT
cls
echo.
echo [7/7] ‚úÖ INSTALLATION TERMIN√âE!
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.
echo ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
echo ‚ïë                                                            ‚ïë
echo ‚ïë           üéâ F√âLICITATIONS GUILLAUME! üéâ                   ‚ïë
echo ‚ïë                                                            ‚ïë
echo ‚ïë      Votre syst√®me Drain Fortin est maintenant pr√™t!      ‚ïë
echo ‚ïë                                                            ‚ïë
echo ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
echo.
echo üìã R√âSUM√â DE L'INSTALLATION:
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo ‚úÖ Syst√®me Paul v39 install√©
echo ‚úÖ Dashboard accessible
echo ‚úÖ Num√©ro configur√©: !phone_number!
echo ‚úÖ Notifications: !email!
echo ‚úÖ Raccourcis cr√©√©s sur le bureau
echo ‚úÖ Documentation dans le dossier
echo.
echo üöÄ PROCHAINES √âTAPES:
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo 1. Double-cliquez sur "Drain Fortin Dashboard" sur votre bureau
echo 2. Connectez-vous avec vos identifiants
echo 3. Testez Paul en appelant !phone_number!
echo 4. Lisez START-HERE-GUILLAUME.md pour le guide complet
echo.
echo üìû SUPPORT:
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo Email: support@autoscaleai.ca
echo Urgence: 1-877-SUPPORT
echo.
echo.
echo Voulez-vous ouvrir le tableau de bord maintenant? (O/N)
set /p open_dashboard=
if /i "!open_dashboard!"=="O" (
    start https://drainfortin.com/admin
    echo.
    echo ‚úÖ Tableau de bord ouvert dans votre navigateur!
)

echo.
echo Voulez-vous lire le guide de d√©marrage? (O/N)
set /p open_guide=
if /i "!open_guide!"=="O" (
    if exist START-HERE-GUILLAUME.md (
        start notepad START-HERE-GUILLAUME.md
    ) else (
        echo Guide non trouv√© dans ce dossier
    )
)

echo.
echo ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
echo.
echo Merci d'avoir choisi AutoScale AI!
echo Bonne chance avec votre nouveau syst√®me! üöÄ
echo.
echo Appuyez sur une touche pour terminer...
pause >nul

:: Cr√©er log d'installation
echo Installation compl√©t√©e le %date% √† %time% > install.log
echo Configuration: >> install.log
echo - Phone: !phone_number! >> install.log
echo - Email: !email! >> install.log
echo - Version: Paul v39 >> install.log

exit /b 0