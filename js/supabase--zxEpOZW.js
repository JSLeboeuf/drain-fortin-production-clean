import{c as e}from"./supabase-DcuI07gC.js";import{l as r}from"./index-CC77URC1.js";const t=e("https://phiduqxcufdmgjvdipyu.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBoaWR1cXhjdWZkbWdqdmRpcHl1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxODQ5ODEsImV4cCI6MjA2Mjc2MDk4MX0.RvOcVHhHpLb7O_79FPHWuDNCQFlfH0FOGvhC9qzZuBc",{auth:{persistSession:!0,autoRefreshToken:!0,detectSessionInUrl:!0},realtime:{params:{eventsPerSecond:10}}}),a={async getRecentCalls(e=10){const{data:a,error:s}=await t.from("vapi_calls").select("*").order("created_at",{ascending:!1}).limit(e);return s?(r.error("Error fetching calls",s),[]):a||[]},async getLeads(e=50){const{data:a,error:s}=await t.from("leads").select("*").order("created_at",{ascending:!1}).limit(e);return s?(r.error("Error fetching leads",s),[]):a||[]},async getSMSLogs(e=20){const{data:a,error:s}=await t.from("sms_logs").select("*").order("created_at",{ascending:!1}).limit(e);return s?(r.error("Error fetching SMS logs",s),[]):a||[]},async getDashboardMetrics(){try{const e=(new Date).toISOString().split("T")[0],{data:r,error:a}=await t.from("vapi_calls").select("*").gte("created_at",e);if(a)throw a;const{data:s,error:o}=await t.from("leads").select("*").gte("created_at",e);if(o)throw o;const c=r?.length||0,n=s?.length||0,i=r?.filter(e=>"P1"===e.priority).length||0,l=r?.reduce((e,r)=>e+(r.duration||0),0)/(c||1);return{totalCalls:c,totalLeads:n,urgentCalls:i,avgDuration:Math.round(l/60),conversionRate:c>0?Math.round(n/c*100):0}}catch(e){return r.error("Error fetching dashboard metrics",e),{totalCalls:0,totalLeads:0,urgentCalls:0,avgDuration:0,conversionRate:0}}},subscribeToNewCalls:e=>t.channel("new-calls").on("postgres_changes",{event:"INSERT",schema:"public",table:"vapi_calls"},r=>{e(r.new)}).subscribe()};export{a,t as s};
